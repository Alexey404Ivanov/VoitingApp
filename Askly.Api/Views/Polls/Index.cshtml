
@model List<Askly.Application.DTOs.Polls.PollDto>

@{
    ViewData["Title"] = "Список опросов";
}

@section HeaderExtras
{
    <style>
        .header-actions {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
            gap: 12px;
        }
        .header-actions {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        /* Доп. класс, чтобы не ломать существующий стиль add-button */
        .btn-palette {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            min-width: fit-content;
            box-sizing: border-box;
        }
    </style>

    <div class="header-actions">
        <button id="btnAdd" class="add-button btn-palette">Создать опрос</button>
        @if (User.Identity?.IsAuthenticated == true)
        {
            <button class="add-button btn-palette" onclick="openProfile()">Профиль</button>
            <button class="add-button btn-palette" onclick="logout()">Выйти</button>
        }
        else
        {
            <button id="btnRegister" class="add-button btn-palette" onclick="switchToRegistration()">Зарегистрироваться</button>
            <button id="btnLogin" class="add-button btn-palette" onclick="switchToAuthorization()">Войти</button>
        }
    </div>
}


<main class="main-content" role="main">
    <div class="poll-grid" id="pollGrid" aria-live="polite">
        @if (Model.Any())
        {
            @foreach (var pole in Model)
            {
                <button class="poll-card" onclick="openPoll('@pole.Id')">
                    <div>
                        <div class="poll-title">@pole.Title</div>
                    </div>
                    <div class="poll-sub">@pole.Options.Count @(pole.Options.Count == 1 ? "вариант" : pole.Options.Count > 1 && pole.Options.Count < 5 ? "варианта" : "вариантов")</div>
                </button>
            }
        }
        else
        {
            <p>Опросы еще не созданы.</p>
        }
    </div>

    <div class="modal-backdrop" id="modalBackdrop">
        <div class="modal" id="modal">
            <h2>Новый опрос</h2>


            <div class="section-title" >Вопрос</div>
            <input id="questionInput" style="width:100%; padding:10px; border-radius:8px; background:#3a3a3a; border:none; color:white;" placeholder="Введите вопрос..." />


            <div class="section-title">Варианты ответа</div>


            <div id="answers"></div>
            

            <button class="add-answer" onclick="addAnswer()">Добавить ответ...</button>
            <div class="hint" id="hint">Можно добавить ещё 9 вариантов ответа.</div>


            <div class="settings">
                
                <div class="setting-item">
                    <input type="checkbox" id="multi" />
                    <label for="multi">Выбор нескольких ответов</label>
                </div>
                
            </div>


            <div class="buttons">
                <div class="btn cancel" id="modalClose">Отмена</div>
                <div class="btn create" id="pollCreate">Создать</div>
            </div>
        </div>
    </div>
    
    <div id="toastContainer" class="toast-container" aria-live="polite" aria-atomic="true"></div>
    
    <script>
        window.isAuthenticated = @(User.Identity?.IsAuthenticated == true ? "true" : "false");
    </script>
    <script src="~/js/index.js"></script>
</main>


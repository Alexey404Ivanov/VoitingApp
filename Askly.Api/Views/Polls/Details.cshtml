@model PollDto
@{
    ViewData["Title"] = Model.Title;
    Layout = "_Layout";
}

@section Styles {
    <link rel="stylesheet" href="~/css/details.css" />
}

<main class="main-content" role="main">
    <div id="poleData" 
         data-model="@Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model))">
    </div>
    
    <div class="poll-details">
        <h2 class="poll-question">@Model.Title</h2>
        <form method="post" id="pollForm">
            <input type="hidden" asp-for="Id"/>
            <fieldset>
                <div class="poll-options">
                    @foreach (var option in Model.Options)
                    {
                        if (Model.IsMultipleChoice)
                        {
                            <label class="option-item">
                                <input type="checkbox" name="selectedOptions" value="@option.Id" class="option-checkbox">
                                <span class="option-text">@option.Text</span>
                            </label>
                        }
                        else
                        {
                            <label class="option-item">
                                <input type="radio" name="selectedOptions" value="@option.Id" required>
                                <span class="option-text">@option.Text</span>
                            </label>
                        }
                    }
                </div>
            </fieldset>

            <div id="validationContainer">
                @* Сюда будет выводиться предупреждение для множественного выбора *@
            </div>

            <button type="submit" id="voteBtn" class="vote-button">Голосовать</button>
        </form>
    </div>

    <div id="toastContainer" class="toast-container" aria-live="polite" aria-atomic="true"></div>
</main>

<script id="poll-data" type="application/json">
@Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model))
</script>

<script> 
    (function () {
    var form = document.getElementById('pollForm');
    if (!form) return;

    var isMultiple = @(Model.IsMultipleChoice.ToString().ToLowerInvariant());

    form.addEventListener('submit', function (e) {
    if (!isMultiple) return; // для одиночного выбора браузер сам проверит required

    var checkedCount = form.querySelectorAll('input.option-checkbox:checked').length;
    var container = document.getElementById('validationContainer');

    // Удаляем старое предупреждение
    var old = document.getElementById('validationWarning');
    if (old) old.remove();

    if (checkedCount === 0) {
    e.preventDefault();
    var div = document.createElement('div');
    div.id = 'validationWarning';
    div.className = 'validation-warning';
    div.textContent = 'Пожалуйста, выберите хотя бы один вариант.';
    container.appendChild(div);
    // для удобства фокусируемся на первом чекбоксе
    var firstCheckbox = form.querySelector('input.option-checkbox');
    if (firstCheckbox) firstCheckbox.focus();
    return false;
}
});
})();
</script>

<script src="/js/details.js"></script>